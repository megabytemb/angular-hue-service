/*! angular-hue-service 21-06-2016 */
"use strict";angular.module("ngHue",[]).service("ngHue",["$http","$q","$log","$interval",function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;f={username:"",apiUrl:"",bridgeIP:""},h=!1,q=new Promise(function(a,b){d(function(c){return""!==f.username?a():c===iterations-1?b():void 0},30,2e3)}),p=function(a){var d;return null==a&&(a=!1),d=b.defer(),h?(d.resolve(),d.promise):""!==f.username||a?""!==f.apiUrl?(h=!0,d.resolve(),d.promise):(""!==f.bridgeIP?(f.apiUrl=e(),h=!0,d.resolve()):g().then(function(a){return null!=a[0]?(f.bridgeIP=a[0].internalipaddress,f.apiUrl=e(),h=!0,d.resolve()):(c.error("Error in setup: Returned data from nupnp is empty. Is there a hue bridge present in this network?"),d.reject)},function(a){return c.error("Error in setup: "+a),d.reject}),d.promise):(c.error("Error in setup: Username has to be set"),d.reject,d.promise)},n=function(d,e,f){var g;return g=b.defer(),a.put(e,f).success(function(a){return o(d,a,g)}).error(function(a){return c.error("Error: "+d,a),g.reject}),g.promise},m=function(d,e,f){var g;return g=b.defer(),a.post(e,f).success(function(a){return o(d,a,g)}).error(function(a){return c.error("Error: "+d,a),g.reject}),g.promise},k=function(d,e){var f;return f=b.defer(),a["delete"](e).success(function(a){return o(d,a,f)}).error(function(a){return c.error("Error: "+d,a),f.reject}),f.promise},l=function(d,e){var f;return f=b.defer(),a.get(e).success(function(a){return o(d,a,f)}).error(function(a){return c.error(""+d,a),f.reject}),f.promise},o=function(a,b,d){return null!=b[0]&&b[0].error?(c.error(""+a,b),d.reject(b)):(c.debug("Response of "+a+":",b),d.resolve(b))},j=function(a){var b,c,d,e;for(null==a&&(a=[]),c=f.apiUrl,d=0,e=a.length;d<e;d++)b=a[d],c+="/"+b;return c},i=function(a,b,d){var e,f;switch(null==b&&(b=[]),null==d&&(d=null),e=a+b.join("/"),f=j(b),a){case"get":return l(e,f);case"post":return m(e,f,d);case"put":return n(e,f,d);case"delete":return k(e,f);default:return c.error("unsupported method "+a)}},g=function(){return l("getBridgeNupnp","https://www.meethue.com/api/nupnp")},e=function(){return"http://"+f.bridgeIP+"/api/"+f.username},this.getBridgeIP=function(){return p().then(function(){return f.bridgeIP})},this.setup=function(a){return null==a&&(a={}),angular.extend(f,a)},this.getLights=function(){return q.then(function(){return p().then(function(){return i("get",["lights"])})})},this.getNewLights=function(){return q.then(function(){return p().then(function(){return i("get",["lights","new"])})})},this.searchNewLights=function(){return q.then(function(){return p().then(function(){return i("post",["lights"],{})})})},this.getLight=function(a){return q.then(function(){return p().then(function(){return i("get",["lights",a])})})},this.setLightName=function(a,b){return q.then(function(){return p().then(function(){return i("put",["lights",a],{name:b})})})},this.setLightState=function(a,b){return q.then(function(){return p().then(function(){return i("put",["lights",a,"state"],b)})})},this.getConfiguration=function(){return q.then(function(){return p().then(function(){return i("get",["config"])})})},this.setConfiguration=function(a){return q.then(function(){return p().then(function(){return i("put",["config"],a)})})},this.createUser=function(a,b){return null==b&&(b=!1),p(!0).then(function(){var c;return c={devicetype:a},b&&(c.username=b),i("post",["api"],c)})},this.deleteUser=function(a){return q.then(function(){return p().then(function(){return i("delete",["config","whitelist",a])})})},this.getFullState=function(){return q.then(function(){return p().then(function(){return i("get")})})},this.getGroups=function(){return q.then(function(){return p().then(function(){return i("get",["groups"])})})},this.createGroup=function(a,b){return q.then(function(){return p().then(function(){var d;return d={lights:b,name:a},c.debug("Debug: createGroup body",d),i("post",["groups"],d)})})},this.getGroupAttributes=function(a){return q.then(function(){return p().then(function(){return i("get",["groups",a])})})},this.setGroupAttributes=function(a,b,c){return q.then(function(){return p().then(function(){var d;return d={lights:c,name:b},i("put",["groups",a],d)})})},this.setGroupState=function(a,b){return q.then(function(){return p().then(function(){return i("put",["groups",a,"action"],b)})})},this.deleteGroup=function(a){return q.then(function(){return p().then(function(){return i("delete",["groups",a])})})},this.getRules=function(){return q.then(function(){return p().then(function(){return i("get",["rules"])})})},this.getRule=function(a){return q.then(function(){return p().then(function(){return i("get",["rules",a])})})},this.createRule=function(a,b,c){return q.then(function(){return p().then(function(){var d;return d={name:a,conditions:b,actions:c},i("post",["rules"],d)})})},this.updateRule=function(a,b,d,e){return null==b&&(b=!1),null==d&&(d=!1),null==e&&(e=!1),q.then(function(){return p().then(function(){var a;return a={},b&&(a.name=b),d&&(a.conditions=d),e&&(a.actions=e),c.debug("Debug: updateRule body",a),i("put",["rules"],a)})})},this.deleteRule=function(a){return q.then(function(){return p().then(function(){return i("delete",["rules",a])})})},this.getSchedules=function(){return q.then(function(){return p().then(function(){return i("get",["schedules"])})})},this.createSchedule=function(a,b,c,d,e,f){return null==a&&(a="schedule"),null==b&&(b=""),null==e&&(e="enabled"),null==f&&(f=!1),q.then(function(){return p().then(function(){var g;return g={name:a,description:b,command:c,time:d,status:e,autodelete:f},i("post",["schedules"],g)})})},this.getScheduleAttributes=function(a){return p().then(function(){return i("get",["schedules",a])})},this.setScheduleAttributes=function(a,b,c,d,e,f,g){return null==b&&(b=null),null==c&&(c=null),null==d&&(d=null),null==e&&(e=null),null==f&&(f=null),null==g&&(g=null),q.then(function(){return p().then(function(){var e;return e={},b&&(e.name=b),c&&(e.description=c),d&&(e.command=d),f&&(e.status=f),null!==g&&(e.autodelete=g),i("put",["schedules",a],e)})})},this.deleteSchedule=function(a){return q.then(function(){return p().then(function(){return i("delete",["schedules",a])})})},this.getScenes=function(){return q.then(function(){return p().then(function(){return i("get",["scenes"])})})},this.createScene=function(a,b,c){return q.then(function(){return p().then(function(){var d;return d={name:b,lights:c},i("put",["scenes",a],d)})})},this.updateScene=function(a,b,c){return q.then(function(){return p().then(function(){return i("put",["scenes",a,"lights",b,"state"],c)})})},this.getSensors=function(){return q.then(function(){return p().then(function(){return i("get",["sensors"])})})},this.createSensor=function(a,b,c,d,e,f,g,h){return null==g&&(g=null),null==h&&(h=null),q.then(function(){return p().then(function(){var j;return j={name:a,modelid:b,swversion:c,type:d,uniqueid:e,manufacturername:f},g&&(j.state=g),h&&(j.config=h),i("post",["sensors"],j)})})},this.searchNewSensors=function(){return q.then(function(){return p().then(function(){return i("post",["sensors"],null)})})},this.getNewSensors=function(){return q.then(function(){return p().then(function(){return i("get",["sensors","new"])})})},this.getSensor=function(a){return q.then(function(){return p().then(function(){return i("get",["sensors",a])})})},this.renameSensor=function(a,b){return q.then(function(){return p().then(function(){var c;return c={name:b},i("put",["sensors",a],c)})})},this.updateSensor=function(a,b){return q.then(function(){return p().then(function(){return i("put",["sensors",a,"config"],b)})})},this.setSensorState=function(a,b){return q.then(function(){return p().then(function(){return i("put",["sensors",a,"state"],b)})})},this.getTimezones=function(){return q.then(function(){return p().then(function(){return i("get",["info","timezones"])})})},this.setEffect=function(a){return function(b,c){return null==c&&(c="none"),a.setLightState(b,{effect:c})}}(this),this.setAlert=function(a){return function(b,c){return null==c&&(c="none"),a.setLightState(b,{alert:c})}}(this),this.setBrightness=function(a){return function(b,c){return a.setLightState(b,{bri:c})}}(this)}]);